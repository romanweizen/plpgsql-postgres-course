–û—Ç–ª–∏—á–Ω–æ üöÄ
–í–æ—Ç –≥–æ—Ç–æ–≤–∞—è, –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç—Ä–µ—Ç—å—è —á–∞—Å—Ç—å –∫—É—Ä—Å–∞ ‚Äî
**`03_triggers_intro.md`**
–≤ —Ç–æ–º –∂–µ —Å—Ç–∏–ª–µ, —á—Ç–æ –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≥–ª–∞–≤—ã.
–û—Ç–∫—Ä–æ–π –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ VS Code ‚Üí –≤—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏ –∫–∞–∫ `03_triggers_intro.md`
–∏ –≤–∫–ª—é—á–∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä (**Ctrl + Shift + V**) ‚Äî –≤—Å—ë –±—É–¥–µ—Ç –∫—Ä–∞—Å–∏–≤–æ –∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ.

---

## üìò `03_triggers_intro.md`

# –¢—Ä–∏–≥–≥–µ—Ä—ã –≤ PostgreSQL ‚Äî OLD, NEW, TG_OP, TG_TABLE_NAME –∏ –∞—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üß≠ –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

* [1. –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∏–≥–≥–µ—Ä –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω](#1-—á—Ç–æ-—Ç–∞–∫–æ–µ-—Ç—Ä–∏–≥–≥–µ—Ä-–∏-–∑–∞—á–µ–º-–æ–Ω-–Ω—É–∂–µ–Ω)
* [2. –¢–∏–ø—ã —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ](#2-—Ç–∏–ø—ã-—Ç—Ä–∏–≥–≥–µ—Ä–æ–≤-–∏-–∏—Ö-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ)
* [3. –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ (OLD, NEW, TG_OP –∏ –¥—Ä—É–≥–∏–µ)](#3-–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ-—Ç—Ä–∏–≥–≥–µ—Ä–æ–≤-old-new-tg_op-–∏-–¥—Ä—É–≥–∏–µ)
* [4. –ü—Ä–∏–º–µ—Ä: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è updated_at](#4-–ø—Ä–∏–º–µ—Ä-–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-–ø–æ–ª—è-updated_at)
* [5. –ü—Ä–∏–º–µ—Ä: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π email –≤ —Ç–∞–±–ª–∏—Ü–µ users](#5-–ø—Ä–∏–º–µ—Ä-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ-–∏–∑–º–µ–Ω–µ–Ω–∏–π-email-–≤-—Ç–∞–±–ª–∏—Ü–µ-users)
* [6. –†–∞–∑–±–æ—Ä: —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É BEFORE –∏ AFTER](#6-—Ä–∞–∑–±–æ—Ä-—Ä–∞–∑–Ω–∏—Ü–∞-–º–µ–∂–¥—É-before-–∏-after)
* [7. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –∞—É–¥–∏—Ç INSERT/UPDATE/DELETE](#7-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è-–∑–∞–¥–∞—á–∞-–∞—É–¥–∏—Ç-insertupdatedelete)
* [8. –ó–∞–¥–∞—á–∏ –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è](#8-–∑–∞–¥–∞—á–∏-–¥–ª—è-—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–≥–æ-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

---

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∏–≥–≥–µ—Ä –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω

**–¢—Ä–∏–≥–≥–µ—Ä (trigger)** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º PostgreSQL, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è:
`INSERT`, `UPDATE`, `DELETE` –∏–ª–∏ `TRUNCATE`.

> üí° –¢—Ä–∏–≥–≥–µ—Ä—ã –ø–æ–∑–≤–æ–ª—è—é—Ç ‚Äú—Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å‚Äù –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ –±–µ–∑ —É—á–∞—Å—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
> –≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –∞—É–¥–∏—Ç–∞, –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:

* –∞—É–¥–∏—Ç –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π;
* –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é;
* –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü;
* –∫–∞—Å–∫–∞–¥–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ—Å—á—ë—Ç –∞–≥—Ä–µ–≥–∞—Ç–æ–≤).

---

## 2. –¢–∏–ø—ã —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

| –¢–∏–ø             | –ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è            |
| --------------- | ----------------- | ------------------------------- |
| `BEFORE INSERT` | –¥–æ –≤—Å—Ç–∞–≤–∫–∏        | –∏–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é |
| `AFTER INSERT`  | –ø–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏     | –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π            |
| `BEFORE UPDATE` | –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è     | –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—è (`updated_at`)    |
| `AFTER UPDATE`  | –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è  | –∞—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π                 |
| `BEFORE DELETE` | –¥–æ —É–¥–∞–ª–µ–Ω–∏—è       | –∫–æ–Ω—Ç—Ä–æ–ª—å —É–¥–∞–ª–µ–Ω–∏–π               |
| `AFTER DELETE`  | –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è    | –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫     |

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

* `FOR EACH ROW` ‚Äî —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ (–Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ).
* `FOR EACH STATEMENT` ‚Äî —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –≤—Å–µ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ (`UPDATE employees SET ...`).

---

## 3. –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ (OLD, NEW, TG_OP –∏ –¥—Ä—É–≥–∏–µ)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è      | –¢–∏–ø    | –û–ø–∏—Å–∞–Ω–∏–µ                                                   |
| --------------- | ------ | ---------------------------------------------------------- |
| `NEW`           | RECORD | –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (`INSERT`, `UPDATE`) |
| `OLD`           | RECORD | —Å—Ç–∞—Ä–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –¥–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ (`UPDATE`, `DELETE`)   |
| `TG_OP`         | TEXT   | —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (`INSERT`, `UPDATE`, `DELETE`, `TRUNCATE`)    |
| `TG_TABLE_NAME` | TEXT   | –∏–º—è —Ç–∞–±–ª–∏—Ü—ã, –≥–¥–µ —Å—Ä–∞–±–æ—Ç–∞–ª —Ç—Ä–∏–≥–≥–µ—Ä                          |
| `TG_WHEN`       | TEXT   | –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞ (`BEFORE` –∏–ª–∏ `AFTER`)                       |
| `TG_LEVEL`      | TEXT   | —É—Ä–æ–≤–µ–Ω—å (`ROW` –∏–ª–∏ `STATEMENT`)                            |
| `current_user`  | TEXT   | –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤—ã–ø–æ–ª–Ω–∏–≤—à–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–µ                    |
| `session_user`  | TEXT   | –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–µ—Å—Å–∏–∏ (—á–∞—Å—Ç–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `current_user`) |

üîπ –ü—Ä–∏–º–µ—Ä –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∏–≥–≥–µ—Ä–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏:

```sql
RAISE NOTICE '–û–ø–µ—Ä–∞—Ü–∏—è: %, –¢–∞–±–ª–∏—Ü–∞: %, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: %', TG_OP, TG_TABLE_NAME, current_user;
```

üü¢ –≠—Ç–æ –≤—ã–≤–µ–¥–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å:
`–û–ø–µ—Ä–∞—Ü–∏—è: UPDATE, –¢–∞–±–ª–∏—Ü–∞: users, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: postgres`

---

## 4. –ü—Ä–∏–º–µ—Ä: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è updated_at

**–ó–∞–¥–∞—á–∞:** –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø–æ–ª–µ `updated_at`.

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username TEXT,
    email TEXT,
    updated_at TIMESTAMP DEFAULT NOW()
);
```

**–§—É–Ω–∫—Ü–∏—è-—Ç—Ä–∏–≥–≥–µ—Ä:**

```sql
CREATE OR REPLACE FUNCTION update_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at := NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

**–ü—Ä–∏–≤—è–∑–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞:**

```sql
CREATE TRIGGER set_updated_at
BEFORE UPDATE ON users
FOR EACH ROW
EXECUTE FUNCTION update_timestamp();
```

üü¢ –¢–µ–ø–µ—Ä—å `updated_at` –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª–µ–Ω –±–µ–∑ —É—á–∞—Å—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## 5. –ü—Ä–∏–º–µ—Ä: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π email –≤ —Ç–∞–±–ª–∏—Ü–µ users

**–°–æ–∑–¥–∞–¥–∏–º —Ç–∞–±–ª–∏—Ü—É –∏—Å—Ç–æ—Ä–∏–∏:**

```sql
CREATE TABLE users_history (
    id SERIAL PRIMARY KEY,
    user_id INT,
    old_email TEXT,
    new_email TEXT,
    changed_at TIMESTAMP DEFAULT NOW()
);
```

**–§—É–Ω–∫—Ü–∏—è-—Ç—Ä–∏–≥–≥–µ—Ä:**

```sql
CREATE OR REPLACE FUNCTION log_user_update()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO users_history (user_id, old_email, new_email)
    VALUES (OLD.id, OLD.email, NEW.email);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

**–ü—Ä–∏–≤—è–∑–∫–∞:**

```sql
CREATE TRIGGER user_update_trigger
AFTER UPDATE ON users
FOR EACH ROW
WHEN (OLD.email IS DISTINCT FROM NEW.email)
EXECUTE FUNCTION log_user_update();
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```sql
INSERT INTO users (username, email) VALUES ('alex', 'a@mail.ru');
UPDATE users SET email = 'alex_new@mail.ru' WHERE username = 'alex';
SELECT * FROM users_history;
```

üü¢ –í `users_history` –ø–æ—è–≤–∏—Ç—Å—è –∑–∞–ø–∏—Å—å —Å `old_email` –∏ `new_email`.

---

## 6. –†–∞–∑–±–æ—Ä: —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É BEFORE –∏ AFTER

| –ü–∞—Ä–∞–º–µ—Ç—Ä         | BEFORE                        | AFTER                  |
| ---------------- | ----------------------------- | ---------------------- |
| –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö           | –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö |
| –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å NEW | ‚úÖ –¥–∞                          | ‚ùå –Ω–µ—Ç                  |
| –î–æ—Å—Ç—É–ø –∫ OLD     | –ø—Ä–∏ UPDATE, DELETE            | –ø—Ä–∏ UPDATE, DELETE     |
| –¢–∏–ø–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏  | –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –≤–∞–ª–∏–¥–∞—Ü–∏—è | –∞—É–¥–∏—Ç, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ     |

üí° **–í—ã–≤–æ–¥:**

* –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π `BEFORE`.
* –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–∫—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π `AFTER`.

---

## 7. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –∞—É–¥–∏—Ç INSERT/UPDATE/DELETE

–°–æ–∑–¥–∞–¥–∏–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –∞—É–¥–∏—Ç–∞ –∏ —Ç—Ä–∏–≥–≥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `users`.

```sql
CREATE TABLE audit_log (
    id SERIAL PRIMARY KEY,
    table_name TEXT,
    operation TEXT,
    old_data JSONB,
    new_data JSONB,
    changed_at TIMESTAMP DEFAULT NOW(),
    user_name TEXT
);
```

**–§—É–Ω–∫—Ü–∏—è:**

```sql
CREATE OR REPLACE FUNCTION audit_changes()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO audit_log (table_name, operation, old_data, new_data, user_name)
    VALUES (
        TG_TABLE_NAME,
        TG_OP,
        to_jsonb(OLD),
        to_jsonb(NEW),
        current_user
    );
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

**–ü—Ä–∏–≤—è–∑–∫–∞:**

```sql
CREATE TRIGGER audit_users
AFTER INSERT OR UPDATE OR DELETE ON users
FOR EACH ROW
EXECUTE FUNCTION audit_changes();
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```sql
INSERT INTO users (username, email) VALUES ('maria', 'maria@mail.ru');
UPDATE users SET email = 'maria_new@mail.ru' WHERE username = 'maria';
DELETE FROM users WHERE username = 'maria';

SELECT table_name, operation, old_data, new_data, user_name FROM audit_log;
```

üü¢ –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç—Ä–∏ –∑–∞–ø–∏—Å–∏ ‚Äî `INSERT`, `UPDATE`, `DELETE` —Å JSONB-–ø–æ–ª—è–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

---

## 8. –ó–∞–¥–∞—á–∏ –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### üß© –£—Ä–æ–≤–µ–Ω—å 1

–°–æ–∑–¥–∞–π —Ç—Ä–∏–≥–≥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫–∏ –∏–∑ `users` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `deleted_users` —Ç–æ–ª—å–∫–æ `id` –∏ `email`.

---

### üß© –£—Ä–æ–≤–µ–Ω—å 2

–°–æ–∑–¥–∞–π —Ç—Ä–∏–≥–≥–µ—Ä `BEFORE INSERT` –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `users`, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç email –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É (`LOWER(email)`).

---

### üß© –£—Ä–æ–≤–µ–Ω—å 3

–°–æ–∑–¥–∞–π —Ç—Ä–∏–≥–≥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏ –∫–∞–∂–¥–æ–º `UPDATE` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `audit_log`,
–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–ª—è ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, `email` –∏–ª–∏ `username`.

---

### üß© –£—Ä–æ–≤–µ–Ω—å 4

–°–æ–∑–¥–∞–π —Ç—Ä–∏–≥–≥–µ—Ä `AFTER INSERT` –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `employees`,
–∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ `log_table` —Å –≤—Ä–µ–º–µ–Ω–µ–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, —Å–æ–∑–¥–∞–≤—à–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.

---

‚úÖ –ü–æ—Å–ª–µ —ç—Ç–æ–π —á–∞—Å—Ç–∏ —Ç—ã —É–º–µ–µ—à—å:

* —Ä–∞–∑–ª–∏—á–∞—Ç—å —Ç–∏–ø—ã —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ (`BEFORE`, `AFTER`);
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `OLD`, `NEW`, `TG_OP`, `TG_TABLE_NAME`;
* —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –∞—É–¥–∏—Ç –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ;
* —Ä–∞–±–æ—Ç–∞—Ç—å —Å JSONB –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤.

---

üìò –°–ª–µ–¥—É—é—â–∏–π —Ñ–∞–π–ª ‚Üí [04_jsonb_audit.md](04_jsonb_audit.md)
**‚ÄúJSONB-–∞—É–¥–∏—Ç –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ PostgreSQL‚Äù**

